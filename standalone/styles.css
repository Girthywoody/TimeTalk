/* Theme variables */
:root {
  --surface: #ffffff;
  --surface-2: #f1f5f9;
  --text: #111827;
  --text-muted: #6b7280;
  --accent: #7c3aed;
  --success: #22c55e;
  --radius: 20px;
  --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
  --shadow-md: 0 4px 8px rgba(0,0,0,0.08);
  font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", sans-serif;
}

.theme-dark {
  --surface: #1f2937;
  --surface-2: #374151;
  --text: #f9fafb;
  --text-muted: #9ca3af;
}

body {
  margin: 0;
  background: var(--surface);
  color: var(--text);
  display: flex;
  flex-direction: column;
  height: 100vh;
  overscroll-behavior: none;
}

.hidden { display: none; }

/* App bar */
.app-bar {
  position: sticky;
  top: 0;
  display: flex;
  align-items: center;
  gap: 8px;
  padding: calc(env(safe-area-inset-top) + 4px) 16px 8px;
  backdrop-filter: blur(12px);
  background: rgba(255,255,255,.8);
  box-shadow: var(--shadow-sm);
  z-index: 10;
}
.theme-dark .app-bar { background: rgba(31,41,55,.8); }
.avatar { width: 32px; height: 32px; border-radius: 50%; }
.partner { flex: 1; display: flex; align-items: center; gap: 8px; }
.partner-name { font-weight: 600; }
.partner-status { font-size: 13px; color: var(--text-muted); }
.actions { display:flex; align-items:center; position:relative; }
.menu { position:absolute; top:56px; right:0; background:var(--surface); border-radius:12px; box-shadow:var(--shadow-md); overflow:hidden; }
.menu button { padding:12px 16px; font-size:15px; background:none; border:none; text-align:left; color:var(--text); width:100%; }

/* Message list */
.message-list {
  flex: 1;
  overflow-y: auto;
  padding: 8px 16px 120px;
  background: var(--surface);
}
.time-header { text-align:center; margin:16px 0; font-size:13px; color:var(--text-muted); }
.unread-divider { text-align:center; margin:8px 0; position:relative; }
.unread-divider::before { content:""; position:absolute; top:50%; left:0; right:0; border-top:1px solid var(--surface-2); }
.unread-divider span { background:var(--surface); padding:0 8px; color:var(--accent); position:relative; font-size:13px; }
.msg { max-width:78%; padding:6px 10px; border-radius:var(--radius); margin:2px 0; position:relative; display:inline-block; animation:msg-in .2s ease-out; }
.msg.me { align-self:flex-end; background:var(--accent); color:#fff; }
.msg.them { align-self:flex-start; background:var(--surface-2); }
.msg.tail.me { border-bottom-right-radius:4px; }
.msg.tail.them { border-bottom-left-radius:4px; }
.meta { display:inline-flex; gap:4px; font-size:13px; color:var(--text-muted); margin-top:2px; }
.msg.me .meta { color: rgba(255,255,255,.8); }
.reply { border-left:3px solid var(--accent); padding-left:8px; margin-bottom:4px; font-size:15px; color:var(--text-muted); }
.reactions { margin-top:4px; display:flex; gap:4px; }
.reaction { background:var(--surface); border-radius:12px; padding:2px 6px; font-size:13px; box-shadow:var(--shadow-sm); transform:scale(0); animation:react-in .2s forwards; }

/* Typing indicator */
.typing { position:absolute; bottom:96px; left:16px; display:flex; gap:4px; padding:8px 12px; border-radius:var(--radius); background:var(--surface-2); box-shadow:var(--shadow-sm); }
.typing .dot { width:6px; height:6px; border-radius:50%; background:var(--text-muted); animation:typing 1.2s infinite; }
.typing .dot:nth-child(2) { animation-delay:.2s; }
.typing .dot:nth-child(3) { animation-delay:.4s; }

/* Scroll fab */
.fab { position:fixed; bottom:120px; right:16px; width:44px; height:44px; border-radius:22px; background:var(--accent); color:#fff; display:flex; align-items:center; justify-content:center; border:none; box-shadow:var(--shadow-md); transition:transform .2s ease; z-index:20; }
.fab.hidden { transform:scale(0); }
.badge { position:absolute; top:-4px; right:-4px; background:var(--success); color:#fff; border-radius:12px; padding:0 4px; font-size:12px; }

/* Reply bar */
.reply-bar { position:fixed; bottom:120px; left:0; right:0; padding:4px 16px; background:var(--surface-2); font-size:15px; color:var(--text); display:flex; justify-content:space-between; align-items:center; box-shadow:var(--shadow-sm); }

/* Composer */
.composer { position:fixed; bottom:64px; left:0; right:0; padding:8px 16px; padding-bottom:calc(8px + env(safe-area-inset-bottom)); background:var(--surface); box-shadow:var(--shadow-md); }
.composer-inner { display:flex; align-items:flex-end; gap:8px; }
.composer-input { flex:1; max-height:120px; overflow-y:auto; border:none; outline:none; border-radius:20px; padding:8px 12px; background:var(--surface-2); resize:none; font-size:17px; }
.icon-btn { width:44px; height:44px; border:none; background:transparent; color:var(--text); display:flex; align-items:center; justify-content:center; border-radius:50%; transition:background .2s; }
.icon-btn:active { background:var(--surface-2); }

/* Bottom nav */
.bottom-nav { position:fixed; bottom:0; left:0; right:0; height:64px; padding-bottom:env(safe-area-inset-bottom); background:var(--surface); display:flex; justify-content:space-around; align-items:center; box-shadow:0 -1px 2px rgba(0,0,0,0.05); }
.nav-btn { flex:1; background:none; border:none; color:var(--text-muted); display:flex; flex-direction:column; align-items:center; gap:4px; font-size:12px; }
.nav-btn.active { color:var(--accent); }

/* Animations */
@keyframes typing { 0%,80%,100% { opacity:.2; } 40% { opacity:1; } }
@keyframes msg-in { from { transform:translateY(10px); opacity:0; } to { transform:translateY(0); opacity:1; } }
@keyframes react-in { to { transform:scale(1); } }

/* Action sheet */
.action-sheet { position:fixed; top:0; left:0; right:0; bottom:0; display:flex; align-items:flex-end; justify-content:center; z-index:30; }
.sheet-backdrop { position:absolute; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,.3); }
.sheet { background:var(--surface); width:100%; border-top-left-radius:16px; border-top-right-radius:16px; box-shadow:var(--shadow-md); padding:8px 0; }
.action-sheet button { width:100%; padding:16px; background:none; border:none; font-size:17px; color:var(--text); }

/* Skeleton loader */
.skeleton { height:20px; background:var(--surface-2); border-radius:8px; margin:8px 0; animation:pulse 1.5s infinite; }
@keyframes pulse { 0%,100%{ opacity:.6; } 50%{ opacity:1; } }

.attachments img { display:block; margin-top:4px; }
.file-card { background:var(--surface); border-radius:12px; padding:8px; font-size:15px; margin-top:4px; box-shadow:var(--shadow-sm); }
.link-card { display:flex; gap:8px; background:var(--surface); border-radius:12px; text-decoration:none; color:var(--text); overflow:hidden; margin-top:4px; box-shadow:var(--shadow-sm); }
.link-card img { width:48px; height:48px; object-fit:cover; }
.link-card div { flex:1; }
.link-card p { margin:0; font-size:13px; color:var(--text-muted); }

/* Connectivity banner */
.connectivity { position:fixed; top:0; left:0; right:0; padding:8px; text-align:center; background:#f87171; color:#fff; font-size:15px; z-index:30; }
.theme-dark .connectivity { background:#b91c1c; }
